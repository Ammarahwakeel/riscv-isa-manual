---
# yaml-language-server: $schema=../docs-resources/schemas/defs-schema.json

$schema: "../docs-resources/schemas/defs-schema.json#"

# Used to create normative rules for cmo.adoc file.
# Tags refer to anchors in any adoc file for any ISA manual.

chapter_name: Zicbo* Extensions-Cache Management Operations

normative_rule_definitions:
  # Memory ordering rules
  - name: PPO_overlap
    summary: PPO overlapping address rule for CMO instructions
    tags: ["norm:PPO_overlap"]

  # Load value rules for invalidate operations
  - name: cmo_invalidate_load_values
    summary: Load value rules for invalidate operations
    tags: ["norm:invalidate_load_val1", "norm:invalidate_load_val2", "norm:invalidate_load_val3", "norm:invalidate_load_val4"]

  # Cache block physical address constraints
  - name: cbo_physical_address_constraints
    summary: Physical address constraints for CBO instructions in cache blocks
    tags: ["norm:PMP_same", "norm:PMA_same", "norm:cbo_rsv"]

  # Cache-block management instruction access rules
  - name: cbm_access
    summary: Cache-block management instruction access permission
    tags: ["norm:cbm_access"]
  - name: cbm_unperm_fault
    summary: Cache-block management instruction fault on unpermitted access
    tags: ["norm:cbm_unperm_fault"]
  - name: cbm_unperm_translate
    summary: Cache-block management instruction address translation behavior
    tags: ["norm:cbm_unperm_translate"]

  # Cache-block zero instruction access rules
  - name: cbz_access
    summary: Cache-block zero instruction access permission
    tags: ["norm:cbz_access"]
  - name: cbz_unperm_fault
    summary: Cache-block zero instruction fault on unpermitted access
    tags: ["norm:cbz_unperm_fault"]
  - name: cbz_unperm_translate
    summary: Cache-block zero instruction address translation behavior
    tags: ["norm:cbz_unperm_translate"]

  # Cache-block prefetch instruction access rules
  - name: cbp_access
    summary: Cache-block prefetch instruction access permission
    tags: ["norm:cbp_access"]
  - name: cbp_unperm_noexcep
    summary: Cache-block prefetch instruction no exception on unpermitted access
    tags: ["norm:cbp_unperm_noexcep"]
  - name: cbp_unperm_translate
    summary: Cache-block prefetch instruction address translation behavior
    tags: ["norm:cbp_unperm_translate"]

  # Exception handling rules
  - name: fault_excep_csr
    summary: CMO instruction fault exception CSR behavior
    tags: ["norm:fault_excep_csr"]
  - name: no_addr_misaligned_excep
    summary: CMO instructions do not generate address-misaligned exceptions
    tags: ["norm:no_addr_misaligned_excep"]

  # Hypervisor extension rules
  - name: h_trans_cache
    summary: CMO instruction hypervisor transformation
    tags: ["norm:h_trans_cache"]
  - name: henvcfg_present
    summary: h{csrname} register presence requirement
    tags: ["norm:henvcfg_present"]

  # CBIE field behavior rules
  - name: xenvcfg-CBIE_field_behavior
    summary: CBIE field behavior for CBO.INVAL instruction execution control
    tags: ["norm:xenvcfg-CBIE_op", "norm:xenvcfg-CBIE_00", "norm:xenvcfg-CBIE_01", "norm:xenvcfg-CBIE_11"]

  # CBCFE field behavior rules
  - name: xenvcfg-CBCFE_field_behavior
    summary: CBCFE field behavior for CBO.CLEAN and CBO.FLUSH instruction execution control
    tags: ["norm:xenvcfg-CBCFE_op", "norm:xenvcfg-CBCFE_0", "norm:xenvcfg-CBCFE_1"]

  # CBZE field behavior rules
  - name: xenvcfg-CBZE_field_behavior
    summary: CBZE field behavior for CBO.ZERO instruction execution control
    tags: ["norm:xenvcfg-CBZE_op", "norm:xenvcfg-CBZE_0", "norm:xenvcfg-CBZE_1"]

  # CSR control rules
  - name: cbo-inval
    summary: CBO.INVAL instruction execution control
    tags: ["norm:cbo-inval"]
  - name: cbo-clean_cbo-flush
    summary: CBO.CLEAN and CBO.FLUSH instruction execution control
    tags: ["norm:cbo-clean_cbo-flush"]
  - name: cbo-zero_basedon_xenvcfg-CBZE
    summary: CBO.ZERO execution control based on xenvcfg.CBZE
    tags: ["norm:cbo-zero_basedon_xenvcfg-CBZE"]
  - name: cbxe_unaffected
    summary: CBIE/CBCFE/CBZE fields do not affect other registers
    tags: ["norm:cbxe_unaffected"]

  # CBO instruction operation rules
  - name: cbo-zero_specified_block
    summary: CBO.ZERO operates on specified cache block
    tags: ["norm:cbo-zero_specified_block"]

  - name: prefetch_operating_block
    summary: Prefetch instructions operate on specified cache block
    tags: ["norm:prefetch_operating_block"]

  - name: cbo-clean_op
    summary: CBO.CLEAN instruction operation
    tags: ["norm:cbo-clean_op"]
  - name: cbo-clean_offset
    summary: CBO.CLEAN offset operand behavior
    tags: ["norm:cbo-clean_offset"]

  - name: cbo-flush_op
    summary: CBO.FLUSH instruction operation
    tags: ["norm:cbo-flush_op"]
  - name: cbo-flush_unaligned
    summary: CBO.FLUSH does not require cache block alignment
    tags: ["norm:cbo-flush_unaligned"]

  - name: cbo-inval_op
    summary: CBO.INVAL instruction operation
    tags: ["norm:cbo-inval_op"]
  - name: cbo-inval_unaligned
    summary: CBO.INVAL does not require cache block alignment
    tags: ["norm:cbo-inval_unaligned"]

  - name: cbo-zero_op
    summary: CBO.ZERO instruction operation
    tags: ["norm:cbo-zero_op"]
  - name: cbo-zero_unaligned
    summary: CBO.ZERO does not require cache block alignment
    tags: ["norm:cbo-zero_unaligned"]
  - name: cbo-zero_offset
    summary: CBO.ZERO offset operand behavior
    tags: ["norm:cbo-zero_offset"]

  - name: prefetch-i_op
    summary: PREFETCH.I instruction operation
    tags: ["norm:prefetch-i_op"]
  - name: prefetch-r_op
    summary: PREFETCH.R instruction operation
    tags: ["norm:prefetch-r_op"]
  - name: prefetch-w_op
    summary: PREFETCH.W instruction operation
    tags: ["norm:prefetch-w_op"]
